parameters:
  - name: branch
    type: string
    displayName: "Select Branch of the app repo"
    default: master
    values:
      - master
      - main
      - prod

steps:
  - checkout: git://webnode@${{ parameters.branch }}
  - task: Npm@1
    inputs:
      command: "install"
      verbose: true
    displayName: "Installing the project"

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: "$(Build.SourcesDirectory)"
      includeRootFolder: false
      archiveType: "zip"
      archiveFile: "$(Build.ArtifactStagingDirectory)/$(nodeZipName)"
      replaceExistingArchive: true
    displayName: "Compressing the Project Files"

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: "$(Build.StagingDirectory)"
      artifact: "$(nodeartifactName)"
    displayName: "Publish NODE Project Artifact"
